{% extends 'base.html' %}
{% block body_block %}
{% load custom_template_tags %}
<div class="container">
    <h2>Photo Feed</h2>
    {% if pictures %}
        <div class="row">
            {% for p in pictures %}
            <div class="col-md-8 mb-4">
                <div class="card">
                    <div class="card-body d-flex flex-row">
                        <div>
                            <!-- Title of photo -->
                            <h4 class="card-title font-weight-bold mb-2">{{ p.title }}</h4>
                            <!-- Date photo was added -->
                            <p class="card-text"><i class="far fa-clock pr-2"></i>{{ p.when_added }}</p>
                        </div>
                    </div>

                    <div class="view overlay">
                        <img class="card-img-top rounded-0" src="{{ p.image.url }}" alt="Card image cap">
                        <a href="#!">
                            <div class="mask rgba-white-slight"></div>
                        </a>
                    </div>

                    <!-- Description contained within a collapsible card -->
                    <div class="card-body">
                        <div class="collapse-content">
                            <p class="card-text collapse" id="collapseContent-{{ p.id }}">{{ p.description }}</p>
                            <a class="btn btn-flat red-text p-1 my-1 mr-0 mml-1 collapsed" data-toggle="collapse"
                               href="#collapseContent-{{ p.id }}" aria-expanded="false"
                               aria-controls="collapseContent-{{ p.id }}">
                                Click for description
                            </a>
                        </div>
                    </div>

                    <!-- Display likes -->
                    <div class="card-body">
                        <p>This picture has {{ p.likes_count }} likes</p>
                    </div>

                    <!-- Add likes -->
                    <div class="card-body">
                        {% user_liked_picture picture_likes user p.id as user_already_liked_picture %}
                        <form id="user_likes_form" method="post" action="{% url 'nowandthen:photo_feed' %}">
                            {% csrf_token %}
                            <input type="hidden" name="image_id" value="{{ p.id }}" />
                            <input type="hidden" name="user_id" value="{{ user.id }}" />
                            {% if not user_already_liked_picture %}
                                <input type="submit" name="add_like" value="Click here to like" class="btn btn-primary" />
                            {% else %}
                                <p>You already liked this picture.</p>
                            {% endif %}
                        </form>
                    </div>
                    <!-- Comment Form -->
                    <div class="card-body">
                        <h2>Have your say!</h2>
                        <form id="comment_form_{{ p.id }}" method="post" action="{% url 'nowandthen:photo_feed' %}">
                            {% csrf_token %}
                            <input type="hidden" name="image_id" value="{{ p.id }}" />
                            <input type="hidden" name="user_id" value="{{ user.id }}" />
                            <div class="form-group">
                                <textarea name="comment_body" rows="3" class="form-control" placeholder="Add your comment here..."></textarea>
                            </div>
                            <input type="submit" name="add_comment" value="Submit" class="btn btn-primary" />
                        </form>

                        <!-- Display comments -->
                        <div>
                            {% for comment in p.comments.all %}
                                <p><strong>{{ comment.user.username }}:</strong> {{ comment.comment_body }}</p>
                            {% empty %}
                                <p>No comments yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- End Card -->
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p><strong>There are no photographs present.</strong></p>
    {% endif %}
</div>
{% endblock %}
